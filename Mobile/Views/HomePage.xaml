<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Mobile.Views.HomePage"
             xmlns:converters="clr-namespace:Mobile.Converters"
             BackgroundColor="#ECECF6"
             Shell.NavBarIsVisible="False"
             x:Name="PaiPage"
             Title="HomePage">

    <ContentPage.Resources>
        <converters:ConcludedIsTrueOrFalseConverter x:Key="ConcludedIsTrueOrFalseConverter"/>
    </ContentPage.Resources>

    <!--<Border
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="0,0,10,5"
                BackgroundColor="#ECECF6" 
                WidthRequest="60" 
                HeightRequest="60" 
                StrokeShape="RoundRectangle 30">
                <Button
                    Command="{Binding AddCard}"
                    CommandParameter="Movie"
                    Text="+"
                    TextColor="Black"
                    FontSize="40"
                    FontAttributes="Bold"
                    BackgroundColor="#D9D9ED"/>
            </Border>-->

    <ScrollView>
        <Grid>
            <Border
                ZIndex="2"
                HorizontalOptions="End"
                VerticalOptions="End"
                Margin="10"
                BackgroundColor="#ECECF6" 
                WidthRequest="80" 
                HeightRequest="80" 
                StrokeShape="RoundRectangle 40">
                <Button
                    Command="{Binding PrevieCommand}"
                    CommandParameter="Movie"
                    Text="{Binding PriveiTitle}"
                    TextColor="Black"
                    FontSize="30"
                    FontAttributes="Bold"
                    BackgroundColor="#D9D9ED"
                    />
            </Border>
            <CollectionView 
                        Grid.Row="1"
                        ZIndex="1"
                        ItemsSource="{Binding Assessments}" 
                        HorizontalOptions="StartAndExpand"
                        MinimumWidthRequest="1000">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" Span="4" VerticalItemSpacing="20"/>
                </CollectionView.ItemsLayout>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Grid RowDefinitions="300,*" ColumnDefinitions="100,100" RowSpacing="0" HorizontalOptions="Center">
                            <Border 
                                    ZIndex="0"
                                    Grid.Row="0"
                                    Grid.Column="0"
                                    Grid.ColumnSpan="2" 
                                    Style="{StaticResource BorderCard}">

                                <Image
                                        Source="{Binding Image}"
                                        Style="{StaticResource ImageCard}">
                                    <Image.GestureRecognizers>
                                        <TapGestureRecognizer Command="{Binding BindingContext.ShowDisplay,Source={x:Reference PaiPage}}" 
                                                              CommandParameter="{Binding Id}"/>
                                    </Image.GestureRecognizers>
                                </Image>
                            </Border>

                            <Grid
                                IsVisible="{Binding BindingContext.ShowPrevie,Source={x:Reference PaiPage}}"
                                ZIndex="1"
                                Grid.Row="0"
                                Grid.Column="0"
                                Grid.ColumnSpan="2">

                                <Border 
                                        BackgroundColor="Black"
                                        Opacity="0.8"
                                        Style="{StaticResource BorderCard}">
                                </Border>
                                <VerticalStackLayout ZIndex="1" HorizontalOptions="CenterAndExpand" VerticalOptions="Center" Spacing="5">
                                    <Label Text="{Binding Name}" Style="{StaticResource TItleCard}"/>
                                    <Label Text="{Binding Assessment,StringFormat='Nota: {0}'}" Style="{StaticResource TItleCard}"/>
                                    <Label Text="{Binding Duration,StringFormat='Paginas: {0}'}" Style="{StaticResource TItleCard}"/>
                                    <Label Text="{Binding Concluded, Converter={converters:ConcludedIsTrueOrFalseConverter},StringFormat='Cocluido: {0}'}" Style="{StaticResource TItleCard}"/>
                                </VerticalStackLayout>
                            </Grid>

                            <Grid Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2">
                                <Border 
                                        Style="{StaticResource BorderDeleteCard}">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer 
                                                    Command="{Binding BindingContext.DeleteCommand,Source={x:Reference PaiPage}}" 
                                                    CommandParameter="{Binding Id}"/>
                                    </Border.GestureRecognizers>
                                    <Image
                                            Source="icon_delete.png"
                                            Style="{StaticResource ImageIconDeleteCard}">
                                    </Image>
                                </Border>

                                <Border
                                        Style="{StaticResource BorderDetalhesCard}">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer 
                                                 Command="{Binding BindingContext.DetailCommand,Source={x:Reference PaiPage}}" 
                                                 CommandParameter="{Binding .}"/>
                                    </Border.GestureRecognizers>
                                    <Image
                                        Source="icon_detalhes.png"
                                        Style="{StaticResource ImageIconDetalhesCard}">
                                    </Image>

                                </Border>
                                <Border
                                        Style="{StaticResource BorderEditCard}">
                                    <Border.GestureRecognizers>
                                        <TapGestureRecognizer 
                                                 Command="{Binding BindingContext.EditCommand,Source={x:Reference PaiPage}}" 
                                                 CommandParameter="{Binding .}"/>
                                    </Border.GestureRecognizers>
                                    <Image
                                             Source="icon_edit.png"
                                             Style="{StaticResource ImageIconEditCard}"/>
                                </Border>
                            </Grid>
                        </Grid>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </ScrollView>

</ContentPage>